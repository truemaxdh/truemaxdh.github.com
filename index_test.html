<!DOCTYPE html>
<html>
  <head>
    <title>truemaxdh.github.io</title>
    <link rel="stylesheet" href="/Style/skin.css">
    <script>
      var genres = [];
      var appList = [];
      //
      window.onload = function() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4) {
            if (this.status == 200) {
              // SUCCESS
              var json = this.responseText;
              appList = JSON.parse(json).AppList;
              for (var i = 0; i < appList.length; i++) {
                var gnre = appList[i].Genre;
                if (genres.find(function(el) {return el==gnre;}) == undefined) {
                  genres.push(gnre);
                }
              }
              showGenres();
            } else {
              alert("failed to load data");
            }
          }
        }
        xhttp.open("GET", "/contents/AppList.json", true);
        xhttp.send();
      }
      
      function showGenres() {
        var board = document.getElementById("contents");
        var crcl_w = 0;
        for (var i = 0; i < genres.length; i++) {
          var crcl = document.createElement("div");
          crcl.className = "bigCircle";
          crcl.innerHTML = genres[i];
          crcl.onclick=function() {openGenre(this.innerHTML);}
          board.appendChild(crcl);
        }
        var wrap = document.getElementById("wrapper");
        wrap.style.width = (genres.length * 322) + "px";
      }
      
      function openGenre(_gnre) {
        var board = document.getElementById("list");
        var html = "<div style='display:inline-block;'>";
        for (var i = 0; i < appList.length; i++) {
          if (_gnre == appList[i].Genre) {
            html += "<div class='square' onclick=\"openDetail(this, " + i + ");\">";
            html += " <p class='p_mid'>" + appList[i].Title + "</p>";
            html += "</div>";
          }
        }
        html += "</div>";
        board.innerHTML = html;
      }
      
      var newEl;
      var pnCont;
      function openDetail(el, idx) {
        newEl = document.createElement("div");
        pnCont = document.getElementById("pannel")
        pnCont.appendChild(newEl);
        newEl.className = el.className;
        newEl.style.position = "fixed";
        newEl.style.left = el.offsetLeft + "px";
        newEl.style.top = el.offsetTop + "px";
        newEl.style.margin = "0";
        newEl.style.transition = "1s";
        
        setTimeout(
          function(){ 
            newEl.style.left = pnCont.offsetLeft + "px";
            newEl.style.top = pnCont.offsetTop + "px";
            newEl.style.width = pnCont.offsetWidth + "px";
            newEl.style.height = pnCont.offsetHeight + "px";
          }, 100);
        setTimeout(
          function(){ 
            var html = "<p class='p_mid'>" + appList[idx].Title + "<br>";
            html += appList[idx].Genre + "<br>";
            html += appList[idx].ShortDesc + "<br>";
            html += appList[idx].Desc + "<br>";
            html += appList[idx].Play + "<br>";
            html += "<a onclick='closeDetail(" + idx + ");'>Close</a></p>";
            newEl.innerHTML = html;
          }, 1100);
      }
      
      function closeDetail(idx) {
        newEl.innerHTML = "<p class='p_mid'>" + appList[idx].Title + "</p>";
        newEl.className = 'square';
        
        setTimeout(function() {pnCont.removeChild(newEl);},1000);
      }
    </script>
  </head>
  <body>
    <div id="wrapper">
      <font color="#73AD21">
        <b>truemaxdh</b>
        <a href="https://github.com/truemaxdh">GitHub</a>
        <hr>
      </font>
      <div id="pannel">
        <p>&nbsp;</p>
        <div id="contents"></div>
        <p>&nbsp;</p>
        <div id="list"></div>
      </div>
    </div>
  </body>
</html>
